<Window x:Class="TodoListApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Todo List" Height="600" Width="450"
        Background="White">
	<Grid Margin="16">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

		<!-- Add Task Section -->
		<Grid Grid.Row="0" Margin="0,0,0,18">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="Auto"/>
				<ColumnDefinition Width="Auto"/>
			</Grid.ColumnDefinitions>

			<TextBox x:Name="TaskInputTextBox" Grid.Column="0"
                     FontSize="15" Padding="7" Margin="0,0,12,0"
                     BorderBrush="#222" BorderThickness="2"
                     KeyDown="TaskInputTextBox_KeyDown"/>

			<ComboBox x:Name="PriorityComboBox" Grid.Column="1"
                      FontSize="15" Padding="7" Margin="0,0,12,0"
                      BorderBrush="#222" BorderThickness="2" Width="120">
				<ComboBoxItem Content="Priority 1" IsSelected="True"/>
				<ComboBoxItem Content="Priority 2"/>
				<ComboBoxItem Content="Priority 3"/>
				<ComboBoxItem Content="Priority 4"/>
				<ComboBoxItem Content="Priority 5"/>
			</ComboBox>

			<Button x:Name="AddButton" Grid.Column="2" Content="Add"
                    Background="#23b04b" Foreground="White" FontWeight="Bold"
                    BorderThickness="0" Padding="25,10" FontSize="16"
                    Click="AddButton_Click"/>
		</Grid>

		<!-- Today Tasks Section -->
		<Grid Grid.Row="1" Margin="0,16,0,0">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<TextBlock Grid.Row="0" Text="Tasks" FontWeight="Bold" FontSize="17" Margin="0,0,0,7"/>

			<Grid Grid.Row="1" Margin="0,8,0,3">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="Auto"/>
				</Grid.ColumnDefinitions>

				<TextBlock x:Name="TodayLabel" Grid.Column="0" Text="Today"
                           FontWeight="Bold" FontSize="17"/>

				<Button x:Name="UpcomingButton" Grid.Column="2" Content="Upcoming Task"
                        Background="White" BorderBrush="#bbb" Foreground="#C30"
                        Padding="11,2" FontSize="14" FontWeight="Bold" Margin="14,0,0,0"
                        Click="UpcomingButton_Click"/>

				<Button x:Name="MoveToArchiveButton" Grid.Column="3" Content="Move to Archive"
                        Background="White" BorderBrush="#bbb" Foreground="#C30"
                        Padding="11,2" FontSize="14" FontWeight="Bold" Margin="14,0,0,0"
                        Click="MoveToArchiveButton_Click"/>
			</Grid>

			<Border Grid.Row="2" BorderBrush="#989898" BorderThickness="3"
                    Background="#fafafa" Padding="8" Margin="0,0,0,12">
				<ListBox x:Name="TodayTasksListBox" BorderThickness="0" Background="Transparent">
					<ListBox.ItemTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal" Margin="0,4">
								<!-- Fixed: Use two-way binding without event handlers -->
								<CheckBox IsChecked="{Binding Completed, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
								<TextBlock Text="{Binding Text}" Margin="10,0,5,0" VerticalAlignment="Center">
									<TextBlock.Style>
										<Style TargetType="TextBlock">
											<Style.Triggers>
												<DataTrigger Binding="{Binding Completed}" Value="True">
													<Setter Property="TextDecorations" Value="Strikethrough"/>
													<Setter Property="Foreground" Value="#888"/>
												</DataTrigger>
											</Style.Triggers>
										</Style>
									</TextBlock.Style>
								</TextBlock>
								<TextBlock Text="{Binding Priority, StringFormat='[{0}]'}" VerticalAlignment="Center"/>
							</StackPanel>
						</DataTemplate>
					</ListBox.ItemTemplate>
				</ListBox>
			</Border>
		</Grid>

		<!-- Unscheduled Tasks Section -->
		<Grid Grid.Row="2" Margin="0,16,0,0">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<TextBlock Grid.Row="0" Text="Unscheduled work" FontWeight="Bold" FontSize="17" Margin="0,0,0,7"/>

			<StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,7">
				<Button x:Name="MoveToTodayButton" Content="Move to Today"
                        Background="#23b04b" Foreground="White" FontWeight="Bold"
                        BorderThickness="0" Padding="18,6" FontSize="15" Margin="12,0,0,0"
                        Click="MoveToTodayButton_Click"/>
				<Button x:Name="ScheduleButton" Content="Schedule"
                        Background="#23b04b" Foreground="White" FontWeight="Bold"
                        BorderThickness="0" Padding="18,6" FontSize="15" Margin="12,0,0,0"
                        Click="ScheduleButton_Click"/>
			</StackPanel>

			<Border Grid.Row="2" BorderBrush="#989898" BorderThickness="3"
                    Background="#fafafa" Padding="8" Margin="0,0,0,12">
				<ListBox x:Name="UnscheduledTasksListBox" BorderThickness="0" Background="Transparent">
					<ListBox.ItemTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal" Margin="0,4">
								<CheckBox Tag="{Binding Id}" Checked="UnscheduledCheckBox_Changed"
                                          Unchecked="UnscheduledCheckBox_Changed"/>
								<TextBlock Text="{Binding Text}" Margin="10,0,5,0" VerticalAlignment="Center"/>
								<TextBlock Text="{Binding Priority, StringFormat='[{0}]'}" VerticalAlignment="Center"/>
							</StackPanel>
						</DataTemplate>
					</ListBox.ItemTemplate>
				</ListBox>
			</Border>
		</Grid>

		<!-- Export Archive Button -->
		<Button x:Name="ExportArchiveButton" Grid.Row="3" Content="Export Archive"
                Background="#23b04b" Foreground="White" FontWeight="Bold"
                BorderThickness="0" Padding="12,7" FontSize="15" Margin="0,12,0,0"
                HorizontalAlignment="Left" Click="ExportArchiveButton_Click"/>

		<!-- Calendar Modal -->
		<Grid x:Name="CalendarModal" Grid.RowSpan="4" Background="#4C000000"
              Visibility="Collapsed">
			<Border Background="White" CornerRadius="8" Padding="18"
                    HorizontalAlignment="Center" VerticalAlignment="Center">
				<StackPanel>
					<Grid Margin="0,0,0,12">
						<TextBlock Text="Select Date" FontWeight="Bold" FontSize="16"
                                   HorizontalAlignment="Center"/>
						<Button Content="×" FontSize="22" Background="Transparent"
                                BorderThickness="0" HorizontalAlignment="Right"
                                VerticalAlignment="Top" Margin="0,-5,-5,0"
                                Click="CloseCalendarButton_Click"/>
					</Grid>

					<Calendar x:Name="DatePicker" Margin="0,0,0,12"/>

					<Button x:Name="CalendarOkButton" Content="OK"
                            Background="#23b04b" Foreground="White" FontWeight="Bold"
                            BorderThickness="0" Padding="20,8" HorizontalAlignment="Center"
                            Click="CalendarOkButton_Click"/>
				</StackPanel>
			</Border>
		</Grid>
	</Grid>
</Window>
